<!doctype html>
<html lang="sk">

<head>
    <meta charset="UTF-8" />
    <title>Skúškové zadanie</title>
    <script src="script.js" async></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Skúškové zadanie</h1>
<div id="myDiv">
    <hr>
    <br>
    <form>
        <label for="userName">Meno používateľa:</label>
        <br>
        <input type="text" id="userName" name="userName" placeholder="Zadaj meno používateľa...">
        <br>
        <input type="submit" id="userNameButton" value="Potvrď">
    </form>
    <br>
    <hr>
    <br>
    <form>
        <label for="inputOctaveCode">Výška prekážky (r):</label>
        <br>
        <input type="number" id="inputOctaveCode" name="inputOctaveCode">
        <br>
        <input type="submit" id="inputOctaveCodeButton" value="Potvrď">
    </form>
    <br>
    <hr>
</div>

<div id="checkboxes" style="display: none">
    <label for="chartValue">Zobraz graf:</label>
    <input type="checkbox" id="chartValue" onclick="myFunction()">

    <label for="animationValue">Zobraz animaciu:</label>
    <input type="checkbox" id="animationValue" onclick="myFunction1()">

</div>

<div id="chart" style="display: none">
    <canvas id="myChart" width="600" height="400"></canvas>
</div>

<div id="animation" style="display: none">
    <h2>LOL</h2>
</div>

<div id="apiDescription" style="display: none">
    <div id="forCss">
        <textarea readonly id="apiDescriptionToPdf">TU BUDE POPIS API</textarea>
    </div>
    <input type="submit" id="savePdf" value="Ulož PDF">
</div>
<input type="submit" id="showApiDescription" value="Zobraz popis API služby">

<script>

    const inputOctaveCode = document.querySelector("#inputOctaveCode");
    const inputOctaveCodeButton = document.querySelector("#inputOctaveCodeButton");
    const popisButton = document.querySelector("#showApiDescription");
    const divPopis = document.querySelector("#apiDescription");

    let r = 0;
    let x1 = 0;
    let x2 = 0;
    let x3 = 0;
    let x4 = 0;
    let x5 = 0;
    let xValues;
    let yValues;

    const canvas = document.getElementById('myChart');
    const ctx = canvas.getContext('2d');

    popisButton.addEventListener('click', () => {
        if(divPopis.style.display === "none"){
            divPopis.style.display = "block";
        }
        else{
            divPopis.style.display = "none";
        }
    })

    //PDF export
    var doc = new jsPDF();
    $('#savePdf').click(function () {
        doc.fromHTML($('#apiDescriptionToPdf').html(), 15, 15, {
            'width': 700
        });
        doc.save('api_documentation.pdf');
    });


    function myFunction() {
        var chartDiv = document.querySelector("#chart")
        var chartValue = document.querySelector("#chartValue");
        if (chartValue.checked == true){
            chartDiv.style.display = "block";
        } else {
            chartDiv.style.display = "none";
        }
    }

    function myFunction1() {
        var animationDiv = document.querySelector("#animation")
        var animationValue = document.querySelector("#animationValue");
        if (animationValue.checked == true){
            animationDiv.style.display = "block";
        } else {
            animationDiv.style.display = "none";
        }
    }

    const config = {
        type: "line",
        data: {
            labels: xValues,
            datasets: [{
                fill: false,
                lineTension: 0,
                backgroundColor: "rgba(0,0,255,1.0)",
                borderColor: "rgba(0,0,255,0.1)",
                data: yValues
            }]
        },

        options: {
            legend: {display: false},
            scales: {}

        }

    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }



    let chart = new Chart(ctx, config);
    inputOctaveCodeButton.addEventListener('click', () => {
        chart.data.labels = ([]);
        chart.data.datasets[0].data = ([]);
        chart.update();

        var checkboxes = document.querySelector("#checkboxes")
        checkboxes.style.display = "block";
        r = inputOctaveCode.value;

        let requestBody = { "r": r, "x1": x1, "x2": x2, "x3": x3, "x4": x4, "x5": x5};
        async function fun(){
            return fetch('https://site131.webte.fei.stuba.sk/skuskove_zadanie/server/computer_aided_system/suspension_system_car/index.php?token=bf78172a88287685b0b4d86c1325abfe1f5e501c', {
                method: 'post',
                body: JSON.stringify(requestBody)

            }).then(
                response => response.json().then(data => ({status: response.status, body: data}))

            )
        }
        const resBody = fun();


        const saveXVariables = async () => {
            chart.clear();
            xValues = [];
            yValues = [];
            const a = await resBody;
            x1 = a.body.x[500][0];
            x2 = a.body.x[500][1];
            x3 = a.body.x[500][2];
            x4 = a.body.x[500][3];
            x5 = a.body.x[500][4];

            let xArray = a.body.t;  // T values
            let yArray = a.body.y;  // Y values

            for (var i = 0; i < xArray.length; i++) {
                xValues = xValues.concat(xArray[i]);
            }
            for (var i = 0; i < yArray.length; i++) {
                yValues = yValues.concat(yArray[i]);
            }
            const button = document.querySelector("#inputOctaveCodeButton");

            for(var i = 0; i < yArray.length; i++){
                button.style.visibility="hidden";
                await sleep(5);
                chart.data.labels.push(xValues[i]);
                chart.data.datasets[0].data.push(yValues[i]);
                chart.update();
            }
            button.style.visibility="visible";

        }

        saveXVariables();


    })


</script>
</body>
</html>